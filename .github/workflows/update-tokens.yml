name: Refresh PAT Token

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily
  workflow_dispatch:

jobs:
  refresh-token:
    runs-on: ubuntu-latest
    steps:
      - name: Set Up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20' # Choose a stable version

      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Define Repository List File
        run: echo "REPOS=repos.txt" >> $GITHUB_ENV

      - name: Verify Repository List File
        env:
          REPOS: ${{ env.REPOS }}
        run: |
          if [ ! -f $REPOS ]; then
            echo "Error: $REPOS not found!"
            exit 1
          fi

      - name: Install Dependencies
        run: npm install @octokit/core jsonwebtoken libsodium-wrappers

      - name: Get Token
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INSTALLATION_ID: ${{ secrets.INSTALLATION_ID }}
          USER_ID: "STGroves"
          SECRET_KEY: "ACCESS_TOKEN"
        run: |
          node run-program.js --verbose